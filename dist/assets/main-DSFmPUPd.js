var Y=Object.defineProperty;var _=(e,t,o)=>t in e?Y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var B=(e,t,o)=>_(e,typeof t!="symbol"?t+"":t,o);import*as U from"https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.7/+esm";import*as s from"https://cdn.jsdelivr.net/npm/three@0.169.0/+esm";import{EffectComposer as D}from"https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/postprocessing/EffectComposer.js";import{RenderPass as I}from"https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/postprocessing/RenderPass.js";import{UnrealBloomPass as $}from"https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/postprocessing/UnrealBloomPass.js";import*as W from"https://cdn.jsdelivr.net/npm/tone@15.0.4/+esm";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=o(i);fetch(i.href,r)}})();class K extends s.LineSegments{constructor(o=10,n=10,i=new s.Color(3866760)){i=new s.Color(i);const r=o/n,c=o/2,d=[],a=[];for(let x=0,m=0,g=-c;x<=n;x++,g+=r){d.push(-c,g,0,c,g,0),d.push(g,-c,0,g,c,0);const S=i;S.toArray(a,m),m+=3,S.toArray(a,m),m+=3,S.toArray(a,m),m+=3,S.toArray(a,m),m+=3}const l=new s.BufferGeometry;l.setAttribute("position",new s.Float32BufferAttribute(d,3)),l.setAttribute("color",new s.Float32BufferAttribute(a,3));const P=new s.LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(l,P);B(this,"type","XYGridHelper");this.updateSize(),window.addEventListener("resize",this.updateSize.bind(this))}updateSize(){const o=window.innerWidth/window.innerHeight,n=7.67;this.scale.set(n*o,n,1)}dispose(){this.geometry.dispose(),this.material.dispose(),window.removeEventListener("resize",this.updateSize.bind(this))}}const L=new W.PolySynth().toDestination();L.volume.value=document.getElementById("volume").valueAsNumber;document.getElementById("volume").addEventListener("change",e=>{L.volume.value=e.target.valueAsNumber});let q=!0;const C={};function J(e,t){q&&(W.start(),q=!1);let o=j(e,t);L.triggerAttackRelease(o,.01)}function j(e,t){const o=(d,a,l,P,x)=>(d-a)*(x-P)/(l-a)+P;let n=o(e,-1,1,0,12),i=o(t,-1,1,11,-1);n=Math.floor(n),i=Math.floor(i);const r=n*12+i;return C[r]==null&&(C[r]=440*Math.pow(2,(r-69)/12)),C[r]}let p={},k=[],w=200;const u={width:window.innerWidth,height:window.innerHeight},Q=document.querySelector("canvas.webgl"),y=new s.Scene,h=new s.PerspectiveCamera(75,u.width/u.height,.1,100);h.position.z=5;y.add(h);const Z=1,ee=12,te=new K(Z,ee);y.add(te);const b=new s.WebGLRenderer({canvas:Q});b.setSize(u.width,u.height);b.setPixelRatio(Math.min(window.devicePixelRatio,2));const E={exposure:1,bloomStrength:1.5,bloomThreshold:0,bloomRadius:0},oe=new I(y,h),ne=new $(new s.Vector2(u.width,u.height),E.bloomStrength,E.bloomRadius,E.bloomThreshold),z=new D(b);z.addPass(oe);z.addPass(ne);const R=[];function ie(){const e=new Float32Array(w*3),t=new Float32Array(w),o=new Float32Array(w*3),n=(Math.random()*.3+.4)*16777215,i=(n>>16&255)/255,r=(n>>8&255)/255,c=(n&255)/255;for(let a=0;a<w;a++){const l=a*3;e[l]=(a/(w-1)-.5)*3,e[l+1]=Math.sin(a/10.5)*.5,e[l+2]=1,o[l]=i,o[l+1]=r,o[l+2]=c,t[a]=(w-a)/(w*50)}const d=new s.BufferGeometry;return d.setAttribute("position",new s.BufferAttribute(e,3)),d.setAttribute("size",new s.BufferAttribute(t,1)),d.setAttribute("color",new s.BufferAttribute(o,3)),d}function re(e){const t=e.points.geometry.attributes.position.array;for(let o=0;o<w;o++){const n=o*3,i=(o-1)*3;if(n===0)t[0]=e.x,t[1]=e.y+.05,t[2]=e.z;else{const r=new s.Vector3(t[n],t[n+1],t[n+2]),c=new s.Vector3(t[i],t[i+1],t[i+2]),d=r.lerp(c,.9);t[n]=d.x,t[n+1]=d.y,t[n+2]=e.z}}e.points.geometry.attributes.position.needsUpdate=!0}function F(e,t,o){var n=new s.Vector3(t,o,.5);n.unproject(h);var i=n.sub(h.position).normalize(),r=-h.position.z/i.z,c=h.position.clone().add(i.multiplyScalar(r));if(!p[e]){const d=ie(),a=new s.ShaderMaterial({vertexShader:`
                attribute float size;
                //attribute vec3 color;
                varying vec3 vColor;

                void main() {
                    vColor = color; // Pass the color to the fragment shader
                    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
                    gl_PointSize = size * (300.0 / -mvPosition.z); // Adjust point size with perspective
                    gl_Position = projectionMatrix * mvPosition;
                }
            `,fragmentShader:`
                varying vec3 vColor;

                void main() {
                    gl_FragColor = vec4(vColor * 30.0, 1.0); // Use the passed color, multiply it, to do emissive
                }
            `,vertexColors:!0,transparent:!0}),l=new s.Points(d,a);y.add(l),p[e]={points:l,x:c.x,y:c.y,z:c.z},k.push(e)}p[e].x=c.x,p[e].y=c.y}function N(e,t,o){let n=new s.Vector3(e,t,.5);n.unproject(h);var i=n.sub(h.position).normalize(),r=-h.position.z/i.z,c=h.position.clone().add(i.multiplyScalar(r));const d=new s.CircleGeometry(.1,32),a=new s.MeshStandardMaterial({color:(Math.random()*.25+.5)*16777215,emissive:(Math.random()*.25+.5)*16777215,emissiveIntensity:2,transparent:!0,map:new s.TextureLoader().load("circle_02.webp")}),l=new s.Mesh(d,a);l.position.set(c.x,c.y,c.z),R.push({mesh:l,scale:.1,opacity:.5}),y.add(l),o&&J(e,t)}let T=0;function V(e){let t=e-T;T=e,z.render(),k.forEach(o=>{p[o]&&re(p[o])}),R.forEach((o,n)=>{o.scale+=.6,o.opacity-=.7*(t/1e3),o.mesh.scale.set(o.scale,o.scale,o.scale),o.mesh.material.opacity=o.opacity,o.opacity<=0&&(y.remove(o.mesh),R.splice(n,1))}),window.requestAnimationFrame(V)}V(0);window.addEventListener("resize",()=>{u.width=window.innerWidth,u.height=window.innerHeight,h.aspect=u.width/u.height,h.updateProjectionMatrix(),b.setSize(u.width,u.height),b.setPixelRatio(Math.min(window.devicePixelRatio,2)),z.setSize(u.width,u.height),z.setPixelRatio(Math.min(window.devicePixelRatio,2))});let A=!1;const M=[0,3e3,1e4,6e4];let H={},G=0,se=document.getElementById("ConnCount");const f=new U.HubConnectionBuilder().withUrl("/hub").withAutomaticReconnect({nextRetryDelayInMilliseconds:e=>{const t=e.previousRetryCount<M.length?e.previousRetryCount:M.length-1;return M[t]}}).build();f.on("move",(e,t,o,n)=>{F(e+t,o,n),H[e]==null&&(H[e]=!0,G++,se.innerText=G.toString())});f.on("click",(e,t,o)=>{N(t,o,e!=f.connectionId)});f.start().then(()=>{A=!0,console.log("SignalR connected")}).catch(e=>{A=!1,console.error("SignalR connection error:",e)});function X(e,t,o){A&&f.send("Move",e,t,o).then(()=>{}).catch(n=>console.error("Error sending move:",n))}function ce(e,t){A&&f.send("Click",e,t).then(()=>{}).catch(o=>console.error("Error sending click:",o))}const v={width:window.innerWidth,height:window.innerHeight};window.addEventListener("resize",()=>{v.width=window.innerWidth,v.height=window.innerHeight});let ae=document.getElementById("Frequency");window.addEventListener("mousemove",e=>{let t=e.clientX/v.width*2-1,o=-(e.clientY/v.height)*2+1;F("selfm",t,o),X(-1,t,o);let n=j(t,o);ae.innerText=n.toFixed(2).toString()});window.addEventListener("touchmove",e=>{for(let t=0;t<e.touches.length;t++){const o=e.touches[t];let n=o.clientX/v.width*2-1,i=-(o.clientY/v.height)*2+1;F("self"+t,n,i),X(t,n,i)}});window.addEventListener("click",e=>{const t=e.clientX/window.innerWidth*2-1,o=-(e.clientY/window.innerHeight)*2+1;N(t,o,!0),ce(t,o)});var O;(O=document.getElementById("FullscreenToggle"))==null||O.addEventListener("click",e=>{document.querySelector("canvas.webgl").requestFullscreen()});fetch("https://ping.aeonax.com/"+window.location,{mode:"no-cors",referrerPolicy:"unsafe-url"});
